[]:2018年11月5日
重新学习django表操作

## 数据库设计：
```
class Blog(models.Model):
    title = models.CharField(verbose_name="标题", max_length=32)
    site_name = models.CharField(verbose_name="站点", max_length=32)
    theme = models.CharField(verbose_name="主题", max_length=32)
   
class Category(models.Model):
    title = models.CharField(verbose_name="分类标题", max_length=32)
    blog = models.ForeignKey(verbose_name="所属博客", to="Blog", to_field="id", on_delete=models.CASCADE)

class Tag(models.Model):
    title = models.CharField(verbose_name="标签名称", max_length=32)
    blog = models.ForeignKey(verbose_name="所属博客", to="Blog", to_field="id", on_delete=models.CASCADE)
    
class Article(models.Model):
    title = models.CharField(verbose_name="文章标题", max_length=32)
    tags = models.ManyToManyField(
        to="Tag", through="Article2Tag",
        through_fields=("article", 'tag'), )

    my_tag = models.ManyToManyField("My_tag")

class My_tag(models.Model):
    title = models.CharField(verbose_name="标签名", max_length=32)



#指定多对多表，只能操作该表，不能操作直接关联表
class Article2Tag(models.Model):
    article = models.ForeignKey(verbose_name="文章", to='Article', on_delete=models.CASCADE)
    tag = models.ForeignKey(verbose_name="标签", to='Tag', on_delete=models.CASCADE)
  
```
Article总表，对应两个关联表表：一对多关联分类表Categroy,多对多关联标签表Tag。两个分类表同时一对多关联站点Blog表。

## 单表添加数据的方法:
```
blog = Blog.objects.create(site_name="b1",title="b1",theme="b1")
```

## 一对多的表添加数据：
先找到一对多的表的对象，把整个对像添加进去，或者用ID
```
    blog = Blog.objects.filter(site_name="b1")[0]
    tag_obj = Tag.objects.create(title="t1",blog = blog)#通过对象
    tag_obj = Tag.objects.create(title="t1",blog_id=2)#通过id
```

## 多对多的添加数据
- 添加
母表对象.多对多表.add(对象1，对象2或者id)
```
#正插
    my_art = Article.objects.filter(id =1)[0]
    my_art.my_tag.add(1,2,3,4,5)
```
```
#反插 _set
    my_tag= My_tag.objects.filter(id = 3)[0]
    my_tag.article_set.add(2,5)
```
- 删除
母表对象.多对多表.remove(对象1，对象2)
用.clear()方法可清空

```
    my_art = Article.objects.filter(id =1)[0]
    #指定删除
    my_art.my_tag.remove(2,3)

    #全清
    my_art.my_tag.clear()
```
- 查询

母表对象.多对多表.all()
得到一个所有对象的集合，querySet对象


经试验，多对多的表格在母表的数据库中，找不到相应的多对多字段。也就是说，多对多的实现方式，本质是通过第三张表，用一对多的方式同时关联两张表来实现的。

## 跨表查询
分为两大类
- 基于对象的查询
一对多的查询
正向查询，母表查子表，按字段
语法：查询对象.关联字段名.all()

反向查询，子表查母表，按表名_set
语法：查询对象.表名_set.all()

上一次查询的结果作为这一次查询的条件
- 基于双下划线的查询
简单粗暴的合成一张表

该部分是django的重点。

[]:6.1.61结束